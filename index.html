<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Shaka Player - Local Server</title>
    <script src="shaka-player.compiled.min.js"></script> <!-- ודא שהקובץ ליד -->
</head>
<body>
    <h1>Shaka Player (Local License Server Demo)</h1>
    <button id="startButton">Start Playback</button><br><br>
    <video id="video" width="640" controls autoplay></video>

    <script>
        document.getElementById('startButton').addEventListener('click', async () => {
            const manifestUri = 'https://77.127.217.139:3443/mpd/ysa1'; // כתובת ל-MPD דרך השרת

            const video = document.getElementById('video');
            const player = new shaka.Player(video);

            // שינוי מסלול הסגמנטים
            player.getNetworkingEngine().registerRequestFilter((type, request) => {
                if (type === shaka.net.NetworkingEngine.RequestType.SEGMENT) {
                    const originalUri = request.uris[0];
                    const segmentPath = originalUri.split('/').slice(-2).join('/'); // דוגמה להוציא last 2 parts
                    request.uris = [`https://77.127.217.139:3443/segment/ysa1?url=${segmentPath}`];
                }
            });

            player.configure({
                drm: {
                    servers: {
                        'org.w3.clearkey': 'https://77.127.217.139:3443/license/ysa1'
                    }
                }
            });

            try {
                await player.load(manifestUri);
                console.log('The video has now been loaded!');
            } catch (e) {
                console.error('Error loading video', e);
            }
        });
    </script>
</body>
</html>
